<Window x:Class="Gomoku_Client.MainGameUI"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Gomoku_Client"
        xmlns:ctrls="clr-namespace:Gomoku_Client.View"
        mc:Ignorable="d"
        Icon="\Assets\Gomoku.ico"
        Title="Gomoku" Height="720" Width="1280" 
        WindowStyle="SingleBorderWindow" 
        WindowStartupLocation="CenterScreen" 
        ResizeMode="NoResize"
        Background="#0F1923"
        Loaded="Window_Loaded"
        Unloaded="Window_Unloaded">

    <WindowChrome.WindowChrome>
        <WindowChrome GlassFrameThickness="0" CornerRadius="0" CaptionHeight="0" UseAeroCaptionButtons="False" ResizeBorderThickness="7"/>
    </WindowChrome.WindowChrome>

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="Styles.xaml"/>
            </ResourceDictionary.MergedDictionaries>

            <Style x:Key="AvatarItemStyle" TargetType="Border">
                <Setter Property="Width" Value="90"/>
                <Setter Property="Height" Value="90"/>
                <Setter Property="CornerRadius" Value="45"/>
                <Setter Property="Margin" Value="0,0,0,25"/>
                <Setter Property="Cursor" Value="Hand"/>
                <Setter Property="BorderThickness" Value="2"/>
                <Setter Property="BorderBrush" Value="Transparent"/>

                <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="BorderBrush" Value="#FF4655"/>
                    </Trigger>
                </Style.Triggers>
            </Style>

            <!-- fade in anim -->
            <Storyboard x:Key="FadeInStoryboard">
                <DoubleAnimation Storyboard.TargetProperty="Opacity"
                From="0" To="1" Duration="0:0:0.3">
                    <DoubleAnimation.EasingFunction>
                        <QuadraticEase EasingMode="EaseOut"/>
                    </DoubleAnimation.EasingFunction>
                </DoubleAnimation>
                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                From="0.8" To="1" Duration="0:0:0.3">
                    <DoubleAnimation.EasingFunction>
                        <BackEase EasingMode="EaseOut" Amplitude="0.3"/>
                    </DoubleAnimation.EasingFunction>
                </DoubleAnimation>
                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)"
                From="0.8" To="1" Duration="0:0:0.3">
                    <DoubleAnimation.EasingFunction>
                        <BackEase EasingMode="EaseOut" Amplitude="0.3"/>
                    </DoubleAnimation.EasingFunction>
                </DoubleAnimation>
            </Storyboard>


            <!-- fade out anim -->
            <Storyboard x:Key="FadeOutStoryboard">
                <DoubleAnimation Storyboard.TargetProperty="Opacity"
                From="1" To="0" Duration="0:0:0.25">
                    <DoubleAnimation.EasingFunction>
                        <QuadraticEase EasingMode="EaseIn"/>
                    </DoubleAnimation.EasingFunction>
                </DoubleAnimation>
                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                From="1" To="0.8" Duration="0:0:0.25">
                    <DoubleAnimation.EasingFunction>
                        <QuadraticEase EasingMode="EaseIn"/>
                    </DoubleAnimation.EasingFunction>
                </DoubleAnimation>
                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)"
                From="1" To="0.8" Duration="0:0:0.25">
                    <DoubleAnimation.EasingFunction>
                        <QuadraticEase EasingMode="EaseIn"/>
                    </DoubleAnimation.EasingFunction>
                </DoubleAnimation>
            </Storyboard>
            <!-- left to right anim (in) -->
            <Storyboard x:Key="SlideInFromRight">
                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.X)"
                             From="1280" To="0" Duration="0:0:0.4">
                    <DoubleAnimation.EasingFunction>
                        <CubicEase EasingMode="EaseOut"/>
                    </DoubleAnimation.EasingFunction>
                </DoubleAnimation>
                <DoubleAnimation Storyboard.TargetProperty="Opacity"
                             From="0" To="1" Duration="0:0:0.3">
                    <DoubleAnimation.EasingFunction>
                        <QuadraticEase EasingMode="EaseOut"/>
                    </DoubleAnimation.EasingFunction>
                </DoubleAnimation>
            </Storyboard>

            <!-- right to left anim (out) -->
            <Storyboard x:Key="SlideOutToLeft">
                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.X)"
                             From="0" To="-400" Duration="0:0:0.3">
                    <DoubleAnimation.EasingFunction>
                        <CubicEase EasingMode="EaseIn"/>
                    </DoubleAnimation.EasingFunction>
                </DoubleAnimation>
                <DoubleAnimation Storyboard.TargetProperty="Opacity"
                             From="1" To="0" Duration="0:0:0.25">
                    <DoubleAnimation.EasingFunction>
                        <QuadraticEase EasingMode="EaseIn"/>
                    </DoubleAnimation.EasingFunction>
                </DoubleAnimation>
            </Storyboard>
        </ResourceDictionary>
    </Window.Resources>

    <Grid>
        <Grid.Background>
            <ImageBrush ImageSource="/Assets/Images/Main.png" 
                        Stretch="UniformToFill" 
                        Opacity="0.4"/>
        </Grid.Background>

        <!-- TOP BAR -->
        <Border Height="40"
        HorizontalAlignment="Right"
        VerticalAlignment="Top"
        Panel.ZIndex="1000"
        Background="Transparent"
        Margin="0,5,5,0">

            <!-- buttons -->
            <StackPanel Grid.Column="2"
                         Orientation="Horizontal"
                         HorizontalAlignment="Right"
                         VerticalAlignment="Center"
                         Margin="0,0,10,0">

                <!-- MINIMIZE -->
                <Button x:Name="MinimizeButton"
                         Width="36"
                         Height="26"
                         ToolTip="Ẩn"
                         Click="MinimizeButton_Click"
                         Style="{StaticResource WindowControlButton}">
                    <Path Stroke="White"
                           StrokeThickness="2"
                           Data="M0,0 L12,0"/>
                </Button>

                <!-- CLOSE -->
                <Button x:Name="CloseButton"
                         Width="36"
                         Height="26"
                         ToolTip="Thoát"
                         Margin="6,0,0,0"
                         Click="CloseButton_Click"
                         Style="{StaticResource CloseWindowButton}">
                    <Path Stroke="White"
                         StrokeThickness="2"
                         Data="M0,0 L12,12 M12,0 L0,12"/>
                </Button>
            </StackPanel>
        </Border>

        <Grid>
            <Grid.Background>
                <LinearGradientBrush StartPoint="0,0.5" EndPoint="1,0.5">
                    <GradientStop Color="#0F1923" Offset="0.0"/>
                    <GradientStop Color="#CC0F1923" Offset="0.15"/>
                    <GradientStop Color="Transparent" Offset="1.0"/>
                </LinearGradientBrush>
            </Grid.Background>
        </Grid>

        <StackPanel x:Name="StackPanelMenu"
            HorizontalAlignment="Left" VerticalAlignment="Center" Margin="50,0,0,0">

            <!-- PLAY BUTTON -->
            <RadioButton x:Name="PlayButton"
                         Content="CHƠI"
                         GroupName="Menu"
                         Cursor="Hand"
                         Background="Transparent"
                         Foreground="#FF4655"
                         FontFamily="Segoe UI"
                         FontSize="80"
                         Margin="0,8,0,8"
                         IsChecked="False"
                         Checked="PlayButton_Checked">

                <RadioButton.Template>
                    <ControlTemplate TargetType="RadioButton">
                        <Grid Background="Transparent">

                            <StackPanel Orientation="Horizontal"
                                        VerticalAlignment="Center">

                                <!-- Bullet -->
                                <Rectangle x:Name="Bullet"
                                           Width="8"
                                           Height="8"
                                           Fill="{TemplateBinding Foreground}"
                                           Margin="0,0,20,0"
                                           VerticalAlignment="Center"
                                           RenderTransformOrigin="0.5,0.5">
                                    <Rectangle.RenderTransform>
                                        <RotateTransform Angle="45"/>
                                    </Rectangle.RenderTransform>
                                </Rectangle>

                                <!-- Text -->
                                <ContentPresenter x:Name="ContentText"
                                                  Content="{TemplateBinding Content}"
                                                  RecognizesAccessKey="True"
                                                  VerticalAlignment="Center">
                                    <ContentPresenter.RenderTransform>
                                        <TranslateTransform x:Name="TranslateTransform"
                                                X="0" Y="0"/>
                                    </ContentPresenter.RenderTransform>
                                </ContentPresenter>

                            </StackPanel>
                        </Grid>

                        <!-- TRIGGERS -->
                        <ControlTemplate.Triggers>

                            <!-- Hover -->
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Foreground" Value="#FF1FF6C7"/>
                                <Trigger.EnterActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetName="TranslateTransform"
                                                                                     Storyboard.TargetProperty="X"
                                                                                     To="15"
                                                                                     Duration="0:0:0.2">
                                                <DoubleAnimation.EasingFunction>
                                                    <QuadraticEase EasingMode="EaseOut"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.EnterActions>

                                <Trigger.ExitActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetName="TranslateTransform"
                                                             Storyboard.TargetProperty="X"
                                                             To="0"
                                                             Duration="0:0:0.2">
                                                <DoubleAnimation.EasingFunction>
                                                    <QuadraticEase EasingMode="EaseOut"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.ExitActions>
                            </Trigger>

                            <!-- Not checked -->
                            <Trigger Property="IsChecked" Value="False">
                                <Setter Property="Opacity" Value="0.8"/>
                            </Trigger>

                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </RadioButton.Template>
            </RadioButton>

            <RadioButton x:Name="HistoryButton" Content="LỊCH SỬ" Style="{StaticResource ValorantMenuItem}" GroupName="Menu" Checked="HistoryButton_Checked"/>
            <RadioButton x:Name="FriendManagerButton" Content="BẠN BÈ" Style="{StaticResource ValorantMenuItem}" GroupName="Menu" Checked="FriendManagerButton_Checked"/>
            <RadioButton x:Name="SettingButton" Content="CÀI ĐẶT" Style="{StaticResource ValorantMenuItem}" GroupName="Menu" Checked="SettingButton_Checked"/>
            <RadioButton x:Name="ExitButton" Content="THOÁT" Style="{StaticResource ValorantMenuItem}" GroupName="Menu" Checked="ExitButton_Checked"/>
        </StackPanel>


        <Grid>

            <!-- Main Content Grid -->
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="350"/>
                </Grid.ColumnDefinitions>

                <!-- Right Side - Player Info & Content -->
                <StackPanel Grid.Column="1" Margin="20,60,40,40">

                    <!-- Player Profile Card -->
                    <Border x:Name="PlayerCard" CornerRadius="0" Padding="20" Margin="0,0,0,20" Height="604">
                        <Border.Background>
                            <ImageBrush ImageSource="/Assets/Avatar/GomokuBannerAlt.png" Stretch="Fill" Opacity="0.4"/>
                        </Border.Background>
                        <Border.Effect>
                            <DropShadowEffect x:Name="GlowEffect" Color="#FF4655" BlurRadius="20" ShadowDepth="0" Opacity="0.6"/>
                        </Border.Effect>

                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Avatar & Name Section -->
                            <Grid Grid.Row="0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- Avatar with Glow -->
                                <Border x:Name="Avatar" Grid.Column="0" Width="80" Height="80" CornerRadius="40" 
                                BorderBrush="#FF4655" BorderThickness="3" Margin="0,0,15,0">
                                    <Border.Effect>
                                        <DropShadowEffect x:Name="AvatarGlow" Color="#FF4655" BlurRadius="15" ShadowDepth="0" Opacity="0.8"/>
                                    </Border.Effect>
                                    <Border.Background>
                                        <ImageBrush x:Name="AvatarBrush"
                                                    Stretch="UniformToFill"/>
                                    </Border.Background>
                                </Border>

                                <!-- Set Avatar Button -->
                                <Button x:Name="EditAvatarButton" Width="26"
                                        Height="26"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Bottom"
                                        Margin="2"
                                        Background="#FF4655"
                                        BorderThickness="0"
                                        Click="EditAvatarButton_Click">
                                    <Path Fill="White"
                                          Width="14"
                                          Height="14"
                                          Stretch="Uniform"
                                          Data="M12 5H14L15.5 7H18C18.55 7 19 7.45 19 8V18C19 18.55 18.55 19 18 19H6C5.45 19 5 18.55 5 18V8C5 7.45 5.45 7 6 7H9L10.5 5H12ZM12 9A4 4 0 1 0 12 17A4 4 0 0 0 12 9Z"/>

                                </Button>

                                <!-- Name & Info -->
                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                    <TextBlock x:Name="tb_PlayerName" Text="PLAYER" FontSize="24" FontWeight="Bold" 
                                       Foreground="#FFFFFF" FontFamily="Segoe UI Black" Margin="5,0,0,0"/>

                                    <!-- Level Badge - Hiển tại chưa sử dụng
                                    <StackPanel Orientation="Horizontal">
                                        <Border Background="#FF4655" CornerRadius="3" Padding="8,3">
                                            <TextBlock Text="Level 127" FontSize="11" FontWeight="Bold" 
                                               Foreground="White" FontFamily="Segoe UI Black"/>
                                        </Border>
                                    </StackPanel>
                                    -->
                                </StackPanel>
                            </Grid>

                            <!-- XP Progress Bar - Hiên tại chưa sử dụng
                            <Grid Grid.Row="1" Margin="0,20,0,0">
                                <Border Height="8" Background="#0F0F1E" CornerRadius="4"/>
                                <Border Height="8" CornerRadius="4" HorizontalAlignment="Left" Width="240">
                                    <Border.Background>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                            <GradientStop Color="#FF4655" Offset="0"/>
                                            <GradientStop Color="#FD6585" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Border.Background>
                                    <Border.Effect>
                                        <DropShadowEffect Color="#FF4655" BlurRadius="10" ShadowDepth="0" Opacity="0.6"/>
                                    </Border.Effect>
                                </Border>
                            </Grid>
                            -->

                            <!-- Stats -->
                            <Grid Grid.Row="2" Margin="0,15,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0">
                                    <TextBlock x:Name="lb_winrate" Text="-" FontSize="20" FontWeight="Bold" Foreground="#FF4655"/>
                                    <TextBlock Text="Win Rate" FontSize="11" Foreground="#8B8B8B"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1">
                                    <TextBlock x:Name="lb_matches" Text="-" FontSize="20" FontWeight="Bold" Foreground="#ECECEC"/>
                                    <TextBlock Text="Matches" FontSize="11" Foreground="#8B8B8B"/>
                                </StackPanel>


                            </Grid>
                        </Grid>
                    </Border>
                </StackPanel>
            </Grid>
        </Grid>


        <Frame x:Name="MainFrame"
               NavigationUIVisibility="Hidden"
               Visibility="Collapsed">
            <Frame.RenderTransform>
                <TranslateTransform X="0" Y="0"/>
            </Frame.RenderTransform>
        </Frame>

        <!-- CHỌN AVATAR -->
        <Grid x:Name="AvatarOverlay"
              Visibility="Collapsed"
              Panel.ZIndex="999">

            <Grid.Background>
                <SolidColorBrush Color="#000000" Opacity="0.7"/>
            </Grid.Background>

            <!-- CARD CHỌN AVATAR -->
            <Border Width="420"
                    Padding="20"
                    Background="#1A1F2E"
                    CornerRadius="16"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center">

                <Border.Effect>
                    <DropShadowEffect x:Name="AvatarChooseGlow" Color="#FF4655"
                                      BlurRadius="30"
                                      ShadowDepth="0"
                                      Opacity="0.6"/>
                </Border.Effect>

                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- HEADER -->
                    <Grid>
                        <TextBlock Text="CHỌN NHÂN VẬT"
                                   Foreground="White"
                                   FontSize="18"
                                   FontWeight="Bold"/>

                        <Button x:Name="CloseAvatarOverlay" 
                                Width="28"
                                Height="28"
                                HorizontalAlignment="Right"
                                Background="Transparent"
                                BorderThickness="0"
                                Click="CloseAvatarOverlay_Click">
                            <Path Stroke="White"
                                  StrokeThickness="2"
                                  Data="M6 6L18 18M18 6L6 18"/>
                        </Button>
                    </Grid>

                    <Border Grid.Row="1"
                            Margin="0,20,0,0"
                            CornerRadius="12"
                            BorderThickness="1"
                            BorderBrush="#2A2F45"
                            Background="#14182A"
                            ClipToBounds="True">
                        <ScrollViewer x:Name="ScrollAvatar" Grid.Row="1"
                                      Margin="0,0,0,0"
                                      MaxHeight="260"
                                      VerticalScrollBarVisibility="Auto"
                                      HorizontalScrollBarVisibility="Disabled">

                            <!-- Scroller Custom -->
                            <ScrollViewer.Resources>
                                <Style TargetType="ScrollBar">
                                    <Setter Property="Width" Value="6"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="ScrollBar">
                                                <Grid Width="6">
                                                    <Track Name="PART_Track" Orientation="Vertical">
                                                        <Track.Thumb>
                                                            <Thumb>
                                                                <Thumb.Template>
                                                                    <ControlTemplate TargetType="Thumb">
                                                                        <Border Background="White"
                                                                                CornerRadius="3"
                                                                                Opacity="0.7"/>
                                                                    </ControlTemplate>
                                                                </Thumb.Template>
                                                            </Thumb>
                                                        </Track.Thumb>
                                                    </Track>
                                                </Grid>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </ScrollViewer.Resources>

                            <ItemsControl ItemsSource="{Binding Avatars}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <UniformGrid Columns="3"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>

                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel HorizontalAlignment="Center"
                                                    Margin="0,0,0,25"
                                                    Cursor="Hand">

                                            <!-- AVATAR -->
                                            <Border Width="90"
                                                    Height="90"
                                                    CornerRadius="45"
                                                    BorderThickness="2"
                                                    BorderBrush="Transparent"
                                                    MouseLeftButtonUp="Border_MouseLeftButtonUp">
                                                <Border.Background>
                                                    <ImageBrush ImageSource="{Binding Image}"
                                                                Stretch="UniformToFill"/>
                                                </Border.Background>
                                            </Border>
                                            <!-- NAME -->
                                            <TextBlock Text="{Binding Name}"
                                                       Width="90"
                                                       TextAlignment="Center"
                                                       Foreground="#CCCCCC"
                                                       FontSize="14"
                                                       Margin="0,6,0,0"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </Border>
                </Grid>
            </Border>
        </Grid>

        <!-- CHỌN AVATAR SECRET -->
        <Grid x:Name="AvatarSecretOverlay"
                       Visibility="Collapsed"
                       Panel.ZIndex="999">

            <Grid.Background>
                <SolidColorBrush Color="#000000" Opacity="0.7"/>
            </Grid.Background>

            <Border Width="420"
                     Padding="20"
                     Background="#1A1F2E"
                     CornerRadius="16"
                     HorizontalAlignment="Center"
                     VerticalAlignment="Center">

                <Border.Effect>
                    <DropShadowEffect x:Name="AvatarSecretChooseGlow" Color="#FF4655"
                               BlurRadius="30"
                               ShadowDepth="0"
                               Opacity="0.6"/>
                </Border.Effect>

                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- HEADER -->
                    <Grid>
                        <TextBlock Text="CHỌN NHÂN VẬT SECRET"
                            Foreground="White"
                            FontSize="18"
                            FontWeight="Bold"/>

                        <Button x:Name="CloseAvatarSecretOverlay" 
                                 Width="28"
                                 Height="28"
                                 HorizontalAlignment="Right"
                                 Background="Transparent"
                                 BorderThickness="0"
                                 Click="CloseAvatarSecretOverlay_Click">
                            <Path Stroke="White"
                                   StrokeThickness="2"
                                   Data="M6 6L18 18M18 6L6 18"/>
                        </Button>
                    </Grid>

                    <Border Grid.Row="1"
                             Margin="0,20,0,0"
                             CornerRadius="12"
                             BorderThickness="1"
                             BorderBrush="#2A2F45"
                             Background="#14182A"
                             ClipToBounds="True">
                        <ScrollViewer x:Name="ScrollAvatarSecret" Grid.Row="1"
                                       Margin="0,0,0,0"
                                       MaxHeight="260"
                                       VerticalScrollBarVisibility="Auto"
                                       HorizontalScrollBarVisibility="Disabled">

                            <!-- Scroller Custom -->
                            <ScrollViewer.Resources>
                                <Style TargetType="ScrollBar">
                                    <Setter Property="Width" Value="6"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="ScrollBar">
                                                <Grid Width="6">
                                                    <Track Name="PART_Track" Orientation="Vertical">
                                                        <Track.Thumb>
                                                            <Thumb>
                                                                <Thumb.Template>
                                                                    <ControlTemplate TargetType="Thumb">
                                                                        <Border Background="White"
                                                                                 CornerRadius="3"
                                                                                 Opacity="0.7"/>
                                                                    </ControlTemplate>
                                                                </Thumb.Template>
                                                            </Thumb>
                                                        </Track.Thumb>
                                                    </Track>
                                                </Grid>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </ScrollViewer.Resources>

                            <ItemsControl ItemsSource="{Binding SecretAvatars}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <UniformGrid Columns="3"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>

                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel HorizontalAlignment="Center"
                                                     Margin="0,0,0,25"
                                                     Cursor="Hand">

                                            <!-- AVATAR -->
                                            <Border Width="90"
                                                     Height="90"
                                                     CornerRadius="45"
                                                     BorderThickness="2"
                                                     BorderBrush="Transparent"
                                                     MouseLeftButtonUp="Border_MouseLeftButtonUp">
                                                <Border.Background>
                                                    <ImageBrush ImageSource="{Binding Image}"
                                                                Stretch="UniformToFill"/>
                                                </Border.Background>
                                            </Border>
                                            <!-- NAME -->
                                            <TextBlock Text="{Binding Name}"
                                                        Width="90"
                                                        TextAlignment="Center"
                                                        Foreground="#CCCCCC"
                                                        FontSize="14"
                                                        Margin="0,6,0,0"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </Border>
                </Grid>
            </Border>
        </Grid>

        <!-- quit confirmation overlay -->
        <Grid x:Name="QuitConfirmationOverlay" 
              Visibility="Collapsed" 
              Panel.ZIndex="1001">
            <Grid.Background>
                <SolidColorBrush Color="#000000" Opacity="0.7"/>
            </Grid.Background>

            <Border HorizontalAlignment="Center" 
            VerticalAlignment="Center"
            RenderTransformOrigin="0.5,0.5">
                <Border.RenderTransform>
                    <ScaleTransform ScaleX="1" ScaleY="1"/>
                </Border.RenderTransform>

                <!-- popup card -->
                <Border x:Name="QuitBorder" Background="#1A1F2E" 
                CornerRadius="3" 
                Width="500" 
                Padding="0"
                BorderBrush="#FF4655" 
                BorderThickness="1">
                    <Border.Effect>
                        <DropShadowEffect x:Name="QuitBorderGlow" Color="#FF4655" BlurRadius="40" ShadowDepth="0" Opacity="0.6"/>
                    </Border.Effect>

                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <!--
                         (I FOUND THIS UNNECESSARY LMAO)
                         header + accent bar
                        <Border Grid.Row="0" 
                        Background="#FF4655" 
                        CornerRadius="4,4,0,0" 
                        Height="6"/>
                        -->
                        <!-- vv BELOW ARE POPUP CONTENT vv -->
                        <StackPanel Grid.Row="1" Margin="40,40,40,30">
                            <!-- icon -->
                            <Border x:Name="QuitIcon" Width="80" Height="80" 
                                    CornerRadius="40" 
                                    Background="#2A2E39"
                                    HorizontalAlignment="Center"
                                    Margin="0,0,0,20">
                                <Border.Effect>
                                    <DropShadowEffect x:Name="QuitIconGlow" Color="#FF4655" BlurRadius="20" ShadowDepth="0" Opacity="0.4"/>
                                </Border.Effect>
                                <Viewbox Width="45" Height="45" 
                                         HorizontalAlignment="Center" 
                                         VerticalAlignment="Center">
                                    <Canvas Width="24" Height="24">
                                        <!-- Door frame -->
                                        <Path x:Name="ExitDraw" Fill="#FF4655" 
                                            Data="M10.09,15.59L11.5,17L16.5,12L11.5,7L10.09,8.41L12.67,11H3V13H12.67L10.09,15.59M19,3H5C3.89,3 3,3.9 3,5V9H5V5H19V19H5V15H3V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.9 20.1,3 19,3Z"/>
                                    </Canvas>
                                </Viewbox>
                            </Border>

                            <!-- title -->
                            <TextBlock Text="XÁC NHẬN THOÁT" 
                               FontSize="32" 
                               FontWeight="Bold" 
                               FontFamily="Segoe UI"
                               Foreground="White" 
                               HorizontalAlignment="Center"
                               Margin="0,0,0,15"/>

                            <!-- message -->
                            <TextBlock Text="Bạn có chắc chắn muốn thoát khỏi trò chơi không?" 
                               FontSize="16" 
                               Foreground="#B0B0B0" 
                               TextWrapping="Wrap"
                               HorizontalAlignment="Center"
                               TextAlignment="Center"
                               LineHeight="24"/>
                        </StackPanel>

                        <!-- action -->
                        <Grid Grid.Row="2" 
                      Margin="40,0,40,40">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="15"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- cancel -->
                            <Button Grid.Column="0"
                            x:Name="CancelQuitButton"
                            Content="HỦY BỎ" 
                            Height="54"
                            Click="CancelQuitButton_Click"
                            Style="{StaticResource CancelButton}"/>

                            <!-- confirm -->
                            <Button Grid.Column="2"
                                    x:Name="ConfirmQuitButton"
                                    Content="THOÁT NGAY" 
                                    Height="54"
                                    Click="ConfirmQuitButton_Click"
                                    Foreground="White"
                                    Background="#FF4655"
                                    FontFamily="Segoe UI"
                                    FontSize="15"
                                    FontWeight="Bold"
                                    Cursor="Hand">

                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="ButtonBorder" 
                                                Background="{TemplateBinding Background}" 
                                                CornerRadius="2">
                                            <Border.Effect>
                                                <DropShadowEffect x:Name="QuitButtonGlow" Color="#FF4655" BlurRadius="20" ShadowDepth="0" Opacity="0.5"/>
                                            </Border.Effect>
                                            <ContentPresenter HorizontalAlignment="Center" 
                                                              VerticalAlignment="Center"
                                                              Margin="0,2,0,0"/>
                                        </Border>

                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background">
                                                    <Setter.Value>
                                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                            <GradientStop Color="#FF5665" Offset="0"/>
                                                            <GradientStop Color="#FF6675" Offset="1"/>
                                                        </LinearGradientBrush>
                                                    </Setter.Value>
                                                </Setter>
                                                <Setter TargetName="ButtonBorder" Property="Effect">
                                                    <Setter.Value>
                                                        <DropShadowEffect Color="#FF4655" BlurRadius="25" ShadowDepth="0" Opacity="0.8"/>
                                                    </Setter.Value>
                                                </Setter>
                                            </Trigger>

                                            <Trigger Property="IsPressed" Value="True">
                                                <Setter Property="Background">
                                                    <Setter.Value>
                                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                            <GradientStop Color="#CC3644" Offset="0"/>
                                                            <GradientStop Color="#DD4654" Offset="1"/>
                                                        </LinearGradientBrush>
                                                    </Setter.Value>
                                                </Setter>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                        </Grid>
                    </Grid>
                </Border>
            </Border>
        </Grid>
        <!-- noti -->
        <ItemsControl ItemsSource="{Binding Source={x:Static ctrls:NotificationManager.Instance}, Path=Notifications}"
              HorizontalAlignment="Right"
              VerticalAlignment="Bottom"
              Margin="0,0,20,20"
              Panel.ZIndex="9999">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <StackPanel VerticalAlignment="Bottom"/>
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <ctrls:Notification x:Name="NotificationControl"
                              Title="{Binding Title}"
                              Message="{Binding Message}"
                              Type="{Binding Type}"
                              AutoCloseDuration="{Binding AutoCloseDuration}"
                              Margin="0,0,0,5"/>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>
    </Grid>
</Window>